# This is a basic workflow to help you get started with Actions

name: Build and Push to Registry

# Controls when the action will run.
on:
  # Triggers the workflow on push or pull request events but only for the master branch
  push:
    branches: [ master ]
  schedule:
    - cron: 0 0 * * 1,4
  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "build"
  php-82:
    strategy:
      matrix:
        target: [fpm, cli, apache, zts]
    env:
      version: '8.2'
      alternate_version: '8'
    uses: ./.github/workflows/build.yml@build-image
    with:
      version: ${{ env.version }}
      dockerfile: ./Dockerfile-${{ matrix.target }}
      tags: |
        ghcr.io/${{ github.repository_owner }}/php:${{ env.version }}-${{ matrix.target }}-${{ needs.build-versions.outputs.date }}
        ${{ github.repository_owner }}/php:${{ env.version }}-${{ matrix.target }}-${{ needs.build-versions.outputs.date }}
        ghcr.io/${{ github.repository_owner }}/php:${{ env.version }}-${{ matrix.target}}-${{ needs.build-versions.outputs.sha }}
        ${{ github.repository_owner }}/php:${{ env.version }}-${{ matrix.target }}-${{ needs.build-versions.outputs.sha }}
        ghcr.io/${{ github.repository_owner }}/php:${{ env.version }}-${{ matrix.target }}
        ${{ github.repository_owner }}/php:${{ env.version }}-${{ matrix.target }}
        ghcr.io/${{ github.repository_owner }}/php:${{ env.alternate_version }}-${{ matrix.target }}
        ${{ github.repository_owner }}/php:${{ env.alternate_version }}-${{ matrix.target }}
        ghcr.io/${{ github.repository_owner }}/php:${{ matrix.target }}
        ${{ github.repository_owner }}/php:${{ matrix.target }}

