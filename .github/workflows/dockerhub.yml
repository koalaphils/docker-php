# This is a basic workflow to help you get started with Actions

name: Build PHP Images and Push to Registries

# Controls when the action will run.
on:
  pull_request:
    branches: [ master ]
  push:
    branches: [ master ]
  workflow_dispatch:

permissions:
  contents: read
  packages: write
  pull-requests: write
  actions: write
  id-token: write
  attestations: write

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  base-images:
    strategy:
      matrix:
        version:
          - '8.4.15'
          - '8.3.28'
          - '8.2.29'
          - '8.1.33'
        variant:
          - cli
          - cli-alpine
          - zts
          - zts-alpine
    uses: ./.github/workflows/base-build.yml
    secrets: inherit
    with:
      version: ${{ matrix.version }}
      variant: ${{ matrix.variant }}
  build-images:
    needs: base-images
    strategy:
      matrix:
        version:
          - '8.4.15'
          - '8.3.28'
          - '8.2.29'
          - '8.1.33'
        variant:
          - apache
          - cli
          - cli-alpine
          - fpm
          - fpm-alpine
          - zts
          - zts-alpine
    uses: ./.github/workflows/image-build.yml
    secrets: inherit
    with:
      version: ${{ matrix.version }}
      variant: ${{ matrix.variant }}
      latest: '8.4.15'